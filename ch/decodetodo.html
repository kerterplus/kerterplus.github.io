<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Descifrador seguro (bsn)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <style>
    :root {
      --bg: #0d1117;
      --panel: #161b22;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #2ea043;
      --border: #30363d;
      --btn-bg: #21262d;
      --btn-hover: #30363d;
      --btn-danger: #da3633;
      --btn-danger-hover: #b92425;
    }

    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 20px;
      background: var(--bg);
      color: var(--text);
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
      font-weight: 600;
    }

    p {
      text-align: center;
      margin-bottom: 25px;
      color: var(--muted);
    }

    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
      padding: 12px;
      border-radius: 10px;
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
      resize: vertical;
    }

    input[type="number"] {
      width: 140px;
      padding: 8px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
    }

    button {
      padding: 10px 14px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--btn-bg);
      cursor: pointer;
      transition: 0.2s;
      color: var(--text);
    }
    button:hover {
      background: var(--btn-hover);
    }

    /* bot√≥n limpiar rojo */
    button:nth-child(5) {
      background: var(--btn-danger);
      border-color: var(--btn-danger);
    }
    button:nth-child(5):hover {
      background: var(--btn-danger-hover);
    }

    pre {
      background: #000000;
      color: var(--text);
      padding: 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      overflow: auto;
      max-height: 420px;
      white-space: pre-wrap;
      margin-top: 12px;
      font-size: 14px;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin: 15px 0;
      justify-content: center;
    }

    label {
      font-size: 14px;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }
  </style>
</head>

<body>
  <h1>üõ† Descifrador seguro (bsn)</h1>
  <p>Pega el c√≥digo ofuscado y presiona <strong>Descifrar</strong></p>

  <textarea id="input" placeholder="Pega aqu√≠ el c√≥digo..."></textarea>

  <div class="row">
    <button onclick="descifrar()">Descifrar</button>
    <button onclick="extraerArray()">Extraer array</button>
    <button onclick="copiarSalida()">Copiar salida</button>
    <button onclick="descargarSalida()">Descargar</button>
    <button onclick="limpiar()">Limpiar</button>
    <label>Offset:</label>
    <input id="offset" type="number" value="51497186" />
  </div>

  <h3>Salida:</h3>
  <pre id="output">(aqu√≠ aparecer√° el c√≥digo descifrado o mensajes de error)</pre>



<!-- ‚úÖ TU JAVASCRIPT ORIGINAL INTACTO -->
<script>
function limpiar(){
  document.getElementById('input').value = '';
  document.getElementById('output').textContent = '';
}

function findArrayLiteral(text){
  let re = /(?:var|let|const)?\s*bsn\s*=\s*(\[[\s\S]*?\]);?/m;
  let m = text.match(re);
  if(m) return {name:'bsn', literal: m[1]};
  re = /(?:var|let|const)\s+([a-zA-Z_$][\w$]*)\s*=\s*(\[[\s\S]*?\]);?/m;
  m = text.match(re);
  if(m) return {name: m[1], literal: m[2]};
  re = /(\[\s*(?:['"][A-Za-z0-9+\/=]{4,}['"]\s*(?:,\s*['"][A-Za-z0-9+\/=]{4,}['"]\s*){2,})\])/m;
  m = text.match(re);
  if(m) return {name: null, literal: m[1]};
  return null;
}

function safeEvalArrayLiteral(literal){
  try {
    const fn = new Function("return " + literal + ";");
    const arr = fn();
    if(!Array.isArray(arr)) throw new Error("No es un array v√°lido.");
    return arr;
  } catch(e){
    throw new Error("Error al evaluar el array: " + e.message);
  }
}

function tryDecodeBase64String(s){
  try { return atob(s); }
  catch(e){ return null; }
}

function descifrar(){
  const input = document.getElementById('input').value;
  const outEl = document.getElementById('output');
  outEl.textContent = '';
  if(!input || input.trim().length === 0){
    outEl.textContent = "Pega primero el c√≥digo ofuscado en el textarea.";
    return;
  }
  const found = findArrayLiteral(input);
  if(!found){
    outEl.textContent = "No pude localizar un array de cadenas en el texto.";
    return;
  }
  let arr;
  try {
    arr = safeEvalArrayLiteral(found.literal);
  } catch(e){
    outEl.textContent = "Fallo al evaluar el array: " + e.message;
    return;
  }
  if(arr.length === 0){
    outEl.textContent = "Array vac√≠o.";
    return;
  }
  const allStrings = arr.every(a => typeof a === 'string');
  if(!allStrings){
    outEl.textContent = "El array extra√≠do no es solo strings:\n\n" + JSON.stringify(arr.slice(0,6), null, 2);
    return;
  }
  const offset = Number(document.getElementById('offset').value) || 0;
  let result = "";
  for(let i=0;i<arr.length;i++){
    const item = arr[i].trim();
    let decoded = tryDecodeBase64String(item);
    if(decoded === null){ result += "[ERR-BASE64]"; continue; }
    const digits = decoded.replace(/\D/g,'');
    if(!digits){ result += "[NO-DIGITS]"; continue; }
    const num = parseInt(digits, 10);
    if(isNaN(num)){ result += "[BAD-NUM]"; continue; }
    const charCode = num - offset;
    if(charCode < 0){ result += "[BAD-OFFSET]"; continue; }
    result += String.fromCharCode(charCode);
  }
  let finalOut = result;
  try { finalOut = decodeURIComponent(escape(result)); }
  catch(e){ finalOut = result; }
  if(/^\s*https?:\/\//i.test(finalOut.trim())){
    outEl.textContent = "Resultado decodificado (probable URL):\n\n" + finalOut;
  } else {
    outEl.textContent = finalOut;
  }
}

function extraerArray(){
  const input = document.getElementById('input').value;
  const outEl = document.getElementById('output');
  const found = findArrayLiteral(input);
  if(!found){
    outEl.textContent = "No encontr√© array literal en el texto.";
    return;
  }
  outEl.textContent = "Nombre variable detectado: " + (found.name || "(no detectado)") + "\n\nArray literal:\n\n" + found.literal;
}

function copiarSalida(){
  const out = document.getElementById('output').textContent || '';
  if(!navigator.clipboard){
    alert('Tu navegador no soporta copiar autom√°ticamente.');
    return;
  }
  navigator.clipboard.writeText(out).then(()=> alert('Salida copiada'), ()=> alert('No se pudo copiar'));
}

function descargarSalida(){
  const text = document.getElementById('output').textContent || '';
  const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'decoded.txt';
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 1500);
}
</script>
</body>
</html>


