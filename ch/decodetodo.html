<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Descifrador seguro (bsn) ‚Äî Dark Workspace</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  :root {
    --bg: #0d1117;
    --panel: #161b22;
    --border: #30363d;
    --text: #e6edf3;
    --accent: #58a6ff;
    --accent-hover: #1f6feb;
    --danger: #d9534f;
    --muted: #8b949e;
    --radius: 10px;
    --font: system-ui, Arial, sans-serif;
  }

  body {
    margin: 0;
    padding: 22px;
    background: var(--bg);
    font-family: var(--font);
    color: var(--text);
  }

  h1 {
    margin-top: 0;
    text-align: center;
    color: var(--accent);
    font-size: 26px;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  textarea {
    width: 100%;
    height: 260px;
    font-family: monospace;
    padding: 14px;
    box-sizing: border-box;
    resize: vertical;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text);
    outline: none;
  }

  .workspace {
    max-width: 1050px;
    margin: auto;
  }

  button {
    padding: 10px 14px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--panel);
    cursor: pointer;
    font-weight: 600;
    transition: 0.15s;
    color: var(--text);
  }

  button:hover {
    background: var(--accent-hover);
    border-color: var(--accent-hover);
  }

  .danger:hover {
    background: var(--danger);
    border-color: var(--danger);
  }

  pre {
    margin-top: 12px;
    background: black;
    border: 1px solid var(--border);
    color: #07dd66;
    padding: 16px;
    border-radius: var(--radius);
    max-height: 480px;
    white-space: pre-wrap;
    overflow-y: auto;
    line-height: 1.5;
  }

  .row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    margin: 14px 0;
  }

  input[type="number"] {
    width: 160px;
    padding: 7px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--panel);
    color: var(--text);
  }

  label {
    font-size: 14px;
  }

  .muted {
    color: var(--muted);
    font-size: 14px;
  }
</style>
</head>
<body>

<div class="workspace">
  <h1>üîê Descifrador seguro (bsn)</h1>
  <p class="muted">Pega el c√≥digo ofuscado (el que contiene <code>var bsn = [...]</code>) y presiona un bot√≥n.</p>

  <textarea id="input" placeholder="Pega aqu√≠ el c√≥digo..."></textarea>

  <div class="row">
    <button onclick="descifrar()">‚úÖ Descifrar</button>
    <button onclick="extraerArray()">üß© Ver solo array</button>
    <button onclick="copiarSalida()">üìã Copiar salida</button>
    <button onclick="descargarSalida()">‚¨áÔ∏è Descargar</button>
    <button class="danger" onclick="limpiar()">üóë Limpiar</button>
    <label>Offset:</label>
    <input id="offset" type="number" value="51497186">
  </div>

  <h3>Salida:</h3>
  <pre id="output">(Aqu√≠ aparecer√° el resultado)</pre>
</div>

<script>
function limpiar(){
  input.value = '';
  output.textContent = '';
}

function findArrayLiteral(text){
  let re = /(?:var|let|const)?\s*bsn\s*=\s*(\[[\s\S]*?\]);?/m;
  let m = text.match(re);
  if (m) return { name:"bsn", literal: m[1] };

  re = /(?:var|let|const)\s+([a-zA-Z_$][\w$]*)\s*=\s*(\[[\s\S]*?\]);?/m;
  m = text.match(re);
  if (m) return { name:m[1], literal:m[2] };

  re = /(\[\s*(?:['"][A-Za-z0-9+\/=]{4,}['"]\s*(?:,\s*['"][A-Za-z0-9+\/=]{4,}['"]\s*){2,})\])/m;
  m = text.match(re);
  if (m) return { name:null, literal:m[1] };

  return null;
}

function safeEvalArrayLiteral(literal){
  try {
    const fn = new Function("return " + literal + ";");
    const arr = fn();
    if(!Array.isArray(arr)) throw new Error("La expresi√≥n no es un array v√°lido.");
    return arr;
  } catch(e){ throw new Error(e.message); }
}

function tryDecodeBase64String(s){
  try { return atob(s); }
  catch { return null; }
}

function descifrar(){
  const txt = input.value.trim();
  if (!txt) return output.textContent = "‚ö†Ô∏è No hay c√≥digo pegado.";

  const found = findArrayLiteral(txt);
  if (!found) return output.textContent = "‚ùå No se encontr√≥ ning√∫n array `bsn`.";

  let arr = safeEvalArrayLiteral(found.literal);
  let offset = Number(offset.value) || 0;
  let result = "";

  arr.forEach(i => {
    let decoded = tryDecodeBase64String(i.trim());
    if(decoded === null) return result += "[ERR]";

    let digits = decoded.replace(/\D/g,'');
    let num = parseInt(digits, 10);
    if(isNaN(num)) return result += "[BAD]";

    result += String.fromCharCode(num - offset);
  });

  try { result = decodeURIComponent(escape(result)) } catch(e){}

  output.textContent = result;
}

function extraerArray(){
  const found = findArrayLiteral(input.value);
  if(!found) return output.textContent = "‚ùå No se encontr√≥ ning√∫n array.";
  output.textContent = found.literal;
}

function copiarSalida(){
  navigator.clipboard.writeText(output.textContent);
  alert("‚úÖ Copiado");
}

function descargarSalida(){
  const blob = new Blob([output.textContent], {type: "text/plain;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "decoded.txt";
  a.click();
}
</script>

</body>
</html>

